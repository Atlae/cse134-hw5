<!-- 
    Make a page for your site as we did in the last assignment that is some experimental page for testing things. This page does have to be linked into your navigation, and it should have the filename methodtest.html The purpose of this page will be to test your ability to call endpoints using JavaScript and writing out the response back to the screen.

The following endpoints will be used:

https://httpbin.org/post
https://httpbin.org/get
https://httpbin.org/put
https://httpbin.org/delete
Create an HTML form with the following fields:

id which will be a number for some fake record id
article_name which will be a text field for some article you might write
article_body which will be a <textarea> containing content of the article
(this field will not be editable or potentially even displayed) date which should be the current date and time of the post generated by a JavaScript call to new Date()
Add in four (4) buttons postBtn, getBtn, putBtn, and deleteBtn which will perform the corresponding HTTP methods and sending them to the end-points above. In other words postBtn would read the data and send it to the https://httpbin.org/post end point.

Note: If you were a stickler for details some of these fields don't make sense in all cases. You are free to add such logic in for limiting fields depending on what you are doing for bonus points.

Your code will issue the appropriate requests with either the XMLHttpRequest or the fetch API. If you want to do both and have a radio or select control to pick which to use you may do so for bonus points.

The data coming back from the end point will be a JSON response. You should read that response and then put it back into the page into a <output> tag with the id value of 'response'. You must format the result in a nice manner using HTML and/ or CSS to create a readable format.

We will leave this up to you to design to give this question a bit of subjectivity. You may consult code online for ideas, but a simple JSON to HTML table script is not difficult and there is no reason for you to try to ponder that from scratch. Other possibilities using lists or even <textarea> or even using CSS property of white-space: pre with tabs might work. Be creative in the solution rather than brute forcing custom code. Do this wrong and waste precious time.

Point distribution : 5pts per method (20pts total), 5pts for form and HTML usage, 10pts for response output, 5pts for code organization (proper use of let, modules, etc.) that would follow ideas previously presented in homework.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Method Test</title>
    </head>
    <body>
        <main>
            <h1>Method Test</h1>
            <form id="echo">
                <label for="id">ID</label>
                <br>
                <input type="number" name="id" id="id" required>
                <br>
                <br>
                <label for="article_name" required>Article Name</label>
                <br>
                <input type="text" name="article_name" id="article_name">
                <br>
                <br>
                <label for="article_body" required>Article Body</label>
                <br>
                <textarea name="article_body" id="article_body" cols="30" rows="10" required></textarea>
                <br>
                <input type="hidden" name="date" id="date" readonly>
                <br>
                <label for="request">Request Type</label>
                <br>
                <input type="radio" name="request" id="xhr" value="XMLHttpRequest">
                <label for="xhr">XMLHttpRequest</label>
                <br>
                <input type="radio" name="request" id="fetch" value="fetch" required>
                <label for="fetch">fetch</label>
            </form>
            <br>
            <button type="button" form="echo" id="postBtn" value="POST">Post</button>
            <button type="button" form="echo" id="getBtn" value="GET">Get</button>
            <button type="button" form="echo" id="putBtn" value="PUT">Put</button>
            <button type="button" form="echo" id="deleteBtn" value="DELETE">Delete</button>
            <br>
            <output id="response"></output>
        </main>
    </body>
    <script>
        let method = '';
        const url = 'https://httpbin.org/';
        const form = document.querySelector('form');
        const date = document.getElementById('date');
        const response = document.getElementById('response');

        // loops through each button to add event listener
        for (const button of document.getElementsByTagName('button')) {
            button.addEventListener('click', () => {

                // clears output
                response.innerHTML = '';

                // sets method to button value, sets date, and scrapes form data
                method = button.value.toLowerCase();
                date.value = new Date().toLocaleString();
                const formData = new FormData(form);

                // field validation: if method is get or delete, only id and 
                // request are required. if method is post or put, all fields
                // are required.
                if (method === 'get' || method === 'delete') {
                    if (formData.get('id') === null || !document.getElementById('id').checkValidity()) {
                        alert('ID is required.');
                        console.log(formData.get('request'))
                        return;
                    } else if (formData.get('request') === null) {
                        alert('Request type is required.');
                        return;
                    }
                } else if (method === 'post' || method === 'put') {
                    if (formData.get('id') === null || !document.getElementById('id').checkValidity()) {
                        alert('ID is required.');
                        return;
                    } else if (formData.get('article_name') === null || !document.getElementById('article_name').checkValidity()) {
                        alert('Article name is required.');
                        return;
                    } else if (formData.get('article_body') === null || !document.getElementById('article_body').checkValidity()) {
                        alert('Article body is required.');
                        return;
                    } else if (formData.get('request') === null) {
                        alert('Request type is required.');
                        return;
                    }
                }

                // query string formation
                const params = (method === 'get' || method === 'delete') ? 
                    '?' + new URLSearchParams(formData) : '';
                

                // if request is XMLHttpRequest, create new XMLHttpRequest
                if (formData.get('request') === 'XMLHttpRequest') {
                    const xhr = new XMLHttpRequest();

                    xhr.onload = () => {
                        if (xhr.status === 200) {
                            response.innerHTML = `<pre>${
                                JSON.stringify(JSON.parse(xhr.responseText), null, 4)
                            }</pre>`;
                        }
                    };

                    xhr.open(method, url + method + params, true);
                    
                    if (method === 'get' || method === 'delete')
                        xhr.send();
                    else
                        xhr.send(formData);

                } else if (formData.get('request') === 'fetch') {
                    if (method === 'get') {
                        fetch(url + method + params)
                        .then(response => response.json())
                        .then(data => {
                            response.innerHTML = `<pre>${
                                JSON.stringify(data, null, 4)
                            }</pre>`;
                        });
                    } else if (method === 'delete') {
                        fetch(url + method + params, {
                            method: method
                        })
                        .then(response => response.json())
                        .then(data => {
                            response.innerHTML = `<pre>${
                                JSON.stringify(data, null, 4)
                            }</pre>`;
                        });
                    } else {
                        fetch(url + method, {
                            method: method,
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            response.innerHTML = `<pre>${
                                JSON.stringify(data, null, 4)
                            }</pre>`;
                        });
                    }
                }
            });
        }
    </script>
</html>